file-encoding:
  stage: quick
  image: ubuntu:latest
  rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
  script:
    - apt-get update && apt-get install -y --no-install-recommends git nkf
    - git diff --name-only $CI_MERGE_REQUEST_DIFF_BASE_SHA $CI_COMMIT_SHA -z | xargs --null nkf -g | grep -vE '(UTF-8|ASCII|BINARY)$' | wc -l | grep -q '^0$'
    - if [ $? -ne 0 ]; then echo "Some files are not UTF-8 encoded."; exit 1; fi
